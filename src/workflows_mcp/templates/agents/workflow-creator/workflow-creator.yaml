name: workflow-creator
description: Interactive workflow creator using LLM-guided design and validation
version: "2.3"
tags: [agents, interactive, llm, workflow-generation]

inputs:
  questions:
    type: dict
    description: "Questions to ask user. Key matches input name - if input provided, question is skipped"
    default:
      name: "What should this workflow be named? (lowercase, hyphens, e.g., 'data-pipeline')"
      description: "What does this workflow do? (brief description)"
      inputs: "What inputs does the workflow need? (describe parameters and their purposes)"
      outputs: "What should the workflow return? (describe expected outputs)"
      steps: "What are the main steps or phases? (describe the logical flow)"

  workspace:
    type: str
    description: "Path where the workflow file should be saved"
    default: "/tmp/workflow-creator"
    required: false

  max_validation_attempts:
    type: num
    description: "Maximum number of validation fix attempts"
    default: 10

blocks:
  - id: bootstrap_context
    type: Workflow
    inputs:
      workflow: workflow-creator-bootstrap
      inputs:
        workspace: "{{inputs.workspace}}/bootstrap"
        ref: "feat/workflow-companion"

  - id: generate_requirements
    depends_on: [bootstrap_context]
    type: Workflow
    inputs:
      workflow: workflow-creator-requirements
      inputs:
        questions: "{{inputs.questions}}"
        workspace: "{{inputs.workspace}}/requirements"

  - id: generate_design
    depends_on: [generate_requirements]
    type: Workflow
    inputs:
      workflow: workflow-creator-design
      inputs:
        requirements_path: "{{blocks.generate_requirements.outputs.response_path}}"
        executor_docs_path: "{{blocks.bootstrap_context.outputs.executor_docs_path}}"
        workspace: "{{inputs.workspace}}/generate-design"

  - id: generate_workflow
    depends_on: [generate_design]
    condition: "{{blocks.generate_design.outputs.approved}}"
    type: Workflow
    inputs:
      workflow: workflow-creator-generate-workflow
      inputs:
        diagram_path: "{{blocks.generate_design.outputs.diagram_path}}"
        user_requests: "{{blocks.generate_requirements.outputs.response_path}}"
        executor_docs_path: "{{blocks.bootstrap_context.outputs.executor_docs_path}}"
        examples: "{{blocks.bootstrap_context.outputs.examples}}"
        workspace: "{{inputs.workspace}}/generate-workflow"

  - id: transform_design
    description: "Transform design JSON to valid workflow YAML format"
    depends_on: [generate_workflow]
    condition: "{{blocks.generate_workflow.outputs.approved}}"
    type: Workflow
    inputs:
      workflow: transform-design
      inputs:
        json_path: "{{blocks.generate_workflow.outputs.workflow_path}}"
        output_path: "{{inputs.workspace}}/draft-workflow.yaml"

  - id: recursive_validation
    depends_on: [transform_design]
    condition: "{{blocks.transform_design.outputs.approved}}"
    type: Workflow
    inputs:
      workflow: workflow-creator-validation
      inputs:
        workflow_path: "{{blocks.transform_design.outputs.workflow_path}}"
        schema_path: "{{blocks.bootstrap_context.outputs.schema_path}}"
        executor_docs_path: "{{blocks.bootstrap_context.outputs.executor_docs_path}}"
        workflows_mcp_path: "{{blocks.bootstrap_context.outputs.workspace}}"
        limit: "{{inputs.max_validation_attempts}}"
        workspace: "{{inputs.workspace}}/validation"

  - id: finalize_and_save
    depends_on: [recursive_validation]
    condition: "{{blocks.recursive_validation.outputs.approved}}"
    type: Workflow
    inputs:
      workflow: workflow-creator-summary
      inputs:
        workflow_name: "{{blocks.generate_requirements.outputs.response.name}}"
        workflow_path: "{{blocks.recursive_validation.outputs.workflow_path}}"
        workspace: "{{inputs.workspace}}"
        workflows_mcp_path: "{{blocks.bootstrap_context.outputs.workspace}}"
        iterations: "{{blocks.recursive_validation.outputs.iterations}}"

outputs:
  workflow_name:
    value: "{{blocks.finalize_and_save.outputs.workflow_name}}"
    type: str
    description: "Name of the created workflow"

  workflow_path:
    value: "{{blocks.finalize_and_save.outputs.workflow_path}}"
    type: str
    description: "Path to the saved workflow file"

  summary:
    value: "{{blocks.finalize_and_save.outputs.summary}}"
    type: str
    description: "Complete creation summary with next steps"

  requirements:
    value: "{{blocks.generate_requirements.outputs.response}}"
    type: dict
    description: "Structured workflow requirements"

  success:
    value: "{{blocks.finalize_and_save.succeeded}}"
    type: bool
    description: "Whether workflow creation completed successfully"
