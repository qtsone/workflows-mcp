name: cortex-memory-append
description: |
  Atomic capability: Append to list in memory using composite key.
  Used to accumulate findings, evidence, file contents across phases.

tags: [cortex, capability, atomic, memory]

inputs:
  state:
    type: str
    description: Path to SQLite state database.
    required: true

  type:
    type: str
    description: Memory namespace (e.g., "findings", "evidence").
    required: false
    default: ""

  key:
    type: str
    description: Memory key within namespace (must be a list).
    required: true

  value:
    type: str
    description: Value to append (JSON string).
    required: true

blocks:
  - id: append
    type: Workflow
    inputs:
      workflow: agent-state-management
      inputs:
        state: "{{ inputs.state }}"
        op: memory
        memory_op: append
        memory_type: "{{ inputs.type }}"
        memory_key: "{{ inputs.key }}"
        memory_value: "{{ inputs.value }}"
        caller: "cortex-memory-append"

outputs:
  success:
    value: "{{ blocks.append.succeeded }}"
    type: bool
    description: Whether operation succeeded.

  key:
    value: "{{ inputs.key }}"
    type: str
    description: Key that was appended to.
