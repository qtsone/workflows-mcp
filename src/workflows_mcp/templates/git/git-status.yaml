name: git-status
description: Check git repository status and information
version: "2.0"
author: Workflows MCP Team
tags: [git, status]
inputs:
  working_dir:
    type: str
    description: "(Optional) Path to git repository"
    default: "."
    required: false
blocks:
  - id: analyze_changes
    type: Workflow
    description: "Analyze git repository changes"
    inputs:
      workflow: "git-analyze-changes"
      inputs:
        working_dir: "{{inputs.working_dir}}"

  - id: git_branch
    type: Shell
    description: "Get current git branch name"
    inputs:
      working_dir: "{{inputs.working_dir}}"
      command: |
        git branch --show-current > {{tmp}}/current_branch.txt
      timeout: 5
    outputs:
      name:
        type: str
        description: "Current branch name"
        path: "{{tmp}}/current_branch.txt"

  - id: check_recent_commits
    type: Shell
    inputs:
      working_dir: "{{inputs.working_dir}}"
      command: |
        git log --oneline -5
      timeout: 30
    depends_on:
      - analyze_changes
      - git_branch

  - id: summary
    type: CreateFile
    inputs:
      path: "{{tmp}}/summary.txt"
      overwrite: true
      content: |
        Git Repository Summary:
        - Branch: {{blocks.git_branch.outputs.name}}
        - Has Changes: {{blocks.analyze_changes.outputs.has_changes}}
        - File Status:\n{{blocks.analyze_changes.outputs.summary}}
        - Diff Statistics:\n{{blocks.analyze_changes.outputs.diff}}
        - Recent Commits:\n{{blocks.check_recent_commits.outputs.stdout}}
    depends_on:
      - analyze_changes
      - git_branch
      - check_recent_commits

outputs:
  current_branch:
    value: "{{blocks.git_branch.outputs.name}}"
  summary:
    value: "{{blocks.summary.outputs.content}}"
