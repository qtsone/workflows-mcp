name: git-checkout-branch
description: Create and checkout a new feature branch from base branch
version: "2.0"
author: Workflows MCP Team
tags: [git, checkout, branch, feature]
inputs:
  branch_name:
    type: str
    description: (Required) Name of the feature branch to create
    required: true
  base_branch:
    type: str
    description: (Optional) Base branch to branch from (main, master, develop)
    default: ""
    required: false
  working_dir:
    type: str
    description: (Optional) Git repository directory
    default: "."
    required: false
  fetch_first:
    type: bool
    description: (Optional) Fetch from remote before creating branch
    default: true
    required: false
  push_to_remote:
    type: bool
    description: (Optional) Push branch to remote after creation
    default: false
    required: false
blocks:
  - id: fetch_remote
    condition: "{{inputs.fetch_first}}"
    type: Shell
    description: "Fetch latest changes from remote"
    inputs:
      command: "git fetch origin"
      working_dir: "{{inputs.working_dir}}"
      timeout: 5

  - id: current_branch
    type: Shell
    inputs:
      working_dir: "{{inputs.working_dir}}"
      command: |
        git branch --show-current > {{tmp}}/current_branch.txt
      timeout: 5
    outputs:
      name:
        type: str
        description: "Current branch name"
        path: "{{tmp}}/current_branch.txt"

  - id: checkout_base
    type: Shell
    description: "Checkout base branch"
    inputs:
      command: "git checkout {{inputs.base_branch}}"
      working_dir: "{{inputs.working_dir}}"
      timeout: 30
    condition: "{{inputs.base_branch != '' and inputs.base_branch != blocks.current_branch.outputs.name}}"
    depends_on:
      - block: fetch_remote
        required: false
      - block: current_branch
        required: true

  - id: create_branch
    type: Shell
    inputs:
      command: "git checkout -b {{inputs.branch_name}}"
      working_dir: "{{inputs.working_dir}}"
      timeout: 30
    depends_on:
      - block: checkout_base
        required: false

  - id: push_branch
    condition: "{{inputs.push_to_remote}}"
    type: Shell
    inputs:
      command: "git push -u origin {{inputs.branch_name}}"
      working_dir: "{{inputs.working_dir}}"
      timeout: 60
    depends_on:
      - block: current_branch
        required: true

  - id: summary
    type: Shell
    inputs:
      command: |
        printf "Feature Branch Created:\n"
        printf "- Branch: {{inputs.branch_name}}\n"
        printf "- Base: {{inputs.base_branch}}\n"
        printf "- Current branch: {{blocks.current_branch.outputs.name}}\n"
        printf "- Pushed to remote: {{blocks.push_branch.succeeded}}\n"
    depends_on:
      - block: create_branch
        required: true
      - block: push_branch
        required: false
outputs:
  summary:
    value: "{{blocks.summary.outputs.stdout}}"
