name: secrets-http-auth
description: |
  Test secret resolution in HttpCall headers
  Verifies secrets work in Authorization headers for API calls
tags: [test, core, secrets, http, auth]
inputs:
  base_url:
    type: str
    default: "https://httpbin.org"
    description: "Base URL for HTTP endpoints (no trailing slash)"
blocks:
  # Test secret in Authorization header (local mock echoes headers back)
  - id: api_call_with_secret
    type: HttpCall
    inputs:
      url: "{{inputs.base_url}}/headers"
      method: "GET"
      headers:
        Authorization: "Bearer {{secrets.API_TOKEN}}"
        User-Agent: "workflows-mcp-secrets-test"
      timeout: 10
  # Verify the call succeeded using condition instead of command
  - id: verify_auth_success
    type: Shell
    inputs:
      command: echo "HTTP call succeeded"
    condition: "{{blocks.api_call_with_secret.succeeded}}"
    depends_on: [api_call_with_secret]
outputs:
  api_call_status:
    value: "{{blocks.api_call_with_secret.outputs.status_code}}"
    type: str
  api_call_success:
    value: "{{blocks.api_call_with_secret.succeeded}}"
    type: bool
  auth_verified:
    value: "{{blocks.verify_auth_success.succeeded}}"
    type: bool
  # Response will have secret redacted
  response_body:
    value: "{{blocks.api_call_with_secret.outputs.response_body}}"
    type: str
