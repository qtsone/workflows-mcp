name: secrets-http-auth
description: |
  Test secret resolution in HttpCall headers
  Verifies secrets work in Authorization headers for API calls
tags: [test, core, secrets, http, auth]

blocks:
  # Test secret in Authorization header (httpbin.org/headers echoes headers back)
  - id: api_call_with_secret
    type: HttpCall
    inputs:
      url: "https://httpbin.org/headers"
      method: "GET"
      headers:
        Authorization: "Bearer {{secrets.API_TOKEN}}"
        User-Agent: "workflows-mcp-secrets-test"
      timeout: 10

  # Verify the call succeeded using condition instead of command
  - id: verify_auth_success
    type: Shell
    inputs:
      command: echo "HTTP call succeeded"
    condition: "{{blocks.api_call_with_secret.succeeded}}"
    depends_on: [api_call_with_secret]

outputs:
  api_call_status: "{{blocks.api_call_with_secret.outputs.status_code}}"
  api_call_success: "{{blocks.api_call_with_secret.succeeded}}"
  auth_verified: "{{blocks.verify_auth_success.succeeded}}"
  # Response will have secret redacted
  response_body: "{{blocks.api_call_with_secret.outputs.response_body}}"
